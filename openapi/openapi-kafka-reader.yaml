openapi: 3.0.3
info:
  title: Kafka Reader Ingest API
  version: 1.1.0
  description: >
    Kafka Reader Ingest API defines the REST contract used by the Kafka Reader
    service to forward sliding-window sequences of messages consumed from Kafka
    topics to downstream services.

    The Kafka Reader maintains a window of N most recent ticks. Once the window
    is full, it sends the entire sequence to this API endpoint.

servers:
  - url: http://localhost:5000
    description: Writer / Processor / Downstream service

tags:
  - name: ingest
    description: Kafka message ingestion (sliding window)

paths:
  /receive:
    post:
      tags: [ingest]
      summary: Receive Kafka sliding window sequence
      description: >
        Receives a fixed-size sequence of most recent messages consumed from Kafka.

        Behavior:
          * Reader decodes Kafka payloads from JSON strings to objects
          * Messages are collected into a sliding window of size N (configurable)
          * Once the window is full, it is sent as `sequence`
          * Subsequent polls slide the window automatically

        The endpoint SHOULD accept repeated sequences that overlap in values,
        as sliding windows introduce natural duplication of history.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/KafkaSequence"
      responses:
        "200":
          description: Sequence successfully received
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AckResponse"
        "400":
          description: Invalid request payload
        "500":
          description: Internal processing error

components:
  schemas:
    KafkaSequence:
      type: object
      required:
        - topic
        - sequence
      properties:
        topic:
          type: string
          description: Kafka topic name from which the messages were consumed
          example: fx-ticks
        sequence:
          type: array
          description: >
            The most recent N decoded Kafka messages stored in a sliding window.
            Each entry is a JSON object originally sent to the topic.
          minItems: 1
          items:
            type: object
            description: Decoded Kafka payload
            example:
              event: tick
              symbol: EURUSD
              price: 1.0876
              ts: "2025-01-01T12:00:00.000Z"

    AckResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
        received_at:
          type: string
          format: date-time
          example: "2025-03-01T12:00:00Z"
